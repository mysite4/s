{% extends 'base.html' %}
{% load static %}
{% load json_script %}

{% block title %}ğŸ“Š Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§Ø³Ø¨Ø©{% endblock %}

{% block content %}
<section class="accounting-dashboard fade-in">
  <h1 class="page-title">ğŸ“Š Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø§Ù„ÙŠ Ù„Ù„Ø¹ÙŠØ§Ø¯Ø©</h1>
  <p class="page-subtitle">Ø¹Ø±Ø¶ Ø´Ø§Ù…Ù„ Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹ÙŠØ§Ø¯Ø© Ø§Ù„Ù…Ø§Ù„ÙŠ (Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)</p>

  <!-- Cards -->
  <div class="stats-container">
    <div class="stat-card">
      <h3>ğŸ’° Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>
      <p>{{ total_income }} Ø¯.Ù„</p>
    </div>

    <div class="stat-card">
      <h3>ğŸ“‰ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h3>
      <p>{{ total_expenses }} Ø¯.Ù„</p>
    </div>

    <div class="stat-card">
      <h3>ğŸ“ˆ ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</h3>
      <p>{{ net_profit }} Ø¯.Ù„</p>
    </div>

    <div class="stat-card">
      <h3>ğŸ§¾ Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
      <p>{{ invoice_count }}</p>
    </div>
  </div>

  <!-- Charts -->
  <div class="charts-wrapper">
    <canvas id="incomeChart"></canvas>
    <canvas id="profitChart"></canvas>
  </div>
</section>

<!-- ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Django Ù„Ù€ JS Ø¨Ø£Ù…Ø§Ù† -->
{{ income_data|json_script:"income-data" }}
{{ invoice_labels|json_script:"invoice-labels" }}
{{ total_income|json_script:"total-income" }}
{{ total_expenses|json_script:"total-expenses" }}
{{ net_profit|json_script:"net-profit" }}

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const incomeData = JSON.parse(document.getElementById('income-data').textContent || '[]');
    const invoiceLabels = JSON.parse(document.getElementById('invoice-labels').textContent || '[]');
    const totals = [
        JSON.parse(document.getElementById('total-income').textContent || '0'),
        JSON.parse(document.getElementById('total-expenses').textContent || '0'),
        JSON.parse(document.getElementById('net-profit').textContent || '0')
    ];

    // Chart Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
    const ctxIncome = document.getElementById('incomeChart').getContext('2d');
    new Chart(ctxIncome, {
        type: 'bar',
        data: {
            labels: invoiceLabels,
            datasets: [{
                label: "ğŸ§¾ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©",
                data: incomeData,
                backgroundColor: '#4CAF50',
                borderWidth: 1,
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } }
        }
    });

    // Chart ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­
    const ctxProfit = document.getElementById('profitChart').getContext('2d');
    new Chart(ctxProfit, {
        type: 'bar',
        data: {
            labels: ['Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª', 'Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ', 'Ø§Ù„Ø±Ø¨Ø­'],
            datasets: [{
                data: totals,
                backgroundColor: ['#4CAF50', '#F44336', '#2196F3'],
                borderWidth: 1,
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } }
        }
    });
});
</script>


<p>Labels: {{ invoice_labels }}</p>
<p>Data: {{ income_data }}</p>


{% endblock %}

<style>
.accounting-dashboard {
  padding: 30px;
}

.stats-container {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 18px;
  margin-bottom: 35px;
}

.stat-card {
  background: #fff;
  padding: 18px;
  border-radius: 14px;
  box-shadow: 0px 4px 12px rgba(0,0,0,0.08);
  text-align: center;
  font-size: 18px;
}

.charts-wrapper {
  display: grid;
  gap: 25px;
}

canvas {
  background: #fff;
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0px 4px 12px rgba(0,0,0,0.05);
}
</style>

