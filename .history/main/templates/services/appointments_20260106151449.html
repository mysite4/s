{% extends 'base.html' %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/dashboard.css' %}">

<style>
.classic-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  background: #fff;
}
.classic-table th, .classic-table td {
  border: 1px solid #ddd;
  padding: 10px;
  text-align: center;
}
.classic-table th { background: #f5f5f5; }

@media print {
  body * { visibility: hidden; }
  #print-area, #print-area * { visibility: visible; }
  .no-print { display:none!important; }
}
</style>

<div class="page-container fade-in">
  <h1 class="page-title">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ğŸ“…</h1>

  <div class="tabs no-print">
    <button class="tab-btn active" data-tab="list">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</button>
    <button class="tab-btn" data-tab="add">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯</button>
  </div>

  <!-- Ù‚Ø§Ø¦Ù…Ø© -->
  <div class="tab-content" id="list">
    <button onclick="window.print()" class="btn-main no-print">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>

    <div id="print-area">
      <table class="classic-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Ø§Ù„Ù…Ø±ÙŠØ¶</th>
            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ÙˆÙ‚Øª</th>
            <th>Ø§Ù„Ø·Ø¨ÙŠØ¨</th>
          </tr>
        </thead>
        <tbody>
          {% for appointment in appointments %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ appointment.patient.name }}</td>
            <td>{{ appointment.patient.phone }}</td>
            <td>{{ appointment.date }}</td>
            <td>{{ appointment.time }}</td>
            <td>{{ appointment.doctor.name }}</td>
          </tr>
          {% empty %}
          <tr><td colspan="6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Ø¥Ø¶Ø§ÙØ© -->
  <div class="tab-content no-print" id="add" style="display:none;">
    <h2>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ø¬Ø¯ÙŠØ¯</h2>

    <input type="text" id="add-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø±ÙŠØ¶" required>
    <input type="text" id="add-phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" required>
    <input type="email" id="add-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">

    <select id="add-doctor" required>
      <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø·Ø¨ÙŠØ¨</option>
      {% for doctor in doctors %}
      <option value="{{ doctor.id }}">{{ doctor.name }}</option>
      {% endfor %}
    </select>

    <input type="date" id="add-date" required>
    <input type="time" id="add-time" required>

    <textarea id="add-message" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª"></textarea>
    <input type="number" id="add-paid" value="0" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹">

    <button class="btn-main" onclick="addAppointment()">Ø¥Ø¶Ø§ÙØ©</button>
  </div>
</div>

<script>
document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    document.querySelectorAll('.tab-content').forEach(c=>c.style.display='none');
    document.getElementById(btn.dataset.tab).style.display='block';
  }
});

function addAppointment(){
  const fd = new FormData();
  fd.append('name', add-name.value);
  fd.append('phone', add-phone.value);
  fd.append('email', add-email.value);
  fd.append('doctor', add-doctor.value);
  fd.append('date', add-date.value);
  fd.append('time', add-time.value);
  fd.append('message', add-message.value);
  fd.append('paid_amount', add-paid.value);

  fetch("{% url 'add_appointment' %}",{
    method:'POST',
    body:fd,
    headers:{'X-CSRFToken':'{{ csrf_token }}'}
  })
  .then(r=>r.json())
  .then(d=>{
    if(d.success){ alert('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©'); location.reload(); }
    else alert('Ø®Ø·Ø£');
  });
}
</script>
{% endblock %}
